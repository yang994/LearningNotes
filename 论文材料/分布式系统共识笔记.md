## 分布式系统基础理论

### 分布式系统
+ 分布式系统是一组相互通信的计算机，为了完成共同的任务组成的系统。展现给用户的，功能上与一台计算机无异，可以独立完成用户的需求。对于系统底层，是由多个节点组成，节点之间相互协调各司其职。
+ 分布式系统与单个计算机节点最显著的区别就在于，前者可以完成后者很难实现的特性，更高的可靠性、计算速度、更多的资源等（人多力量大），以数据存储为例，将数据以多副本的方式存在多台计算机上，当其中一台出现故障，也可以保证数据是安全的，因为可以从其他的计算机获得，如果数据只存在一台计算机上，当这台计算机挂掉，数据就没法再获得了。但是由此也会带来诸多需要解决的问题，如信息安全、节点故障、信息不一致、机器异构等（人多嘴杂），接上面的例子，当数据修改时，要修改所有保存了信息的节点，这个过程相比于单个节点就复杂很多了。
+ 简而言之，分布式系统以多个计算机协作的方式，可以完成单个计算机难以完成的复杂任务，但是为了保证系统的正常稳定可靠的运行，也会面临比单个计算机更难的治理问题

### 共识、一致性 核心问题
+ 系统中的节点，对于给定的协议，对于处理结果需要对外保持一致。一致性与处理结果的正确性无关、所有节点失败也是一种一致。
+ 引起不一致的原因：网络不可靠导致的延迟乱序、节点挂掉、节点作恶
+ 一致性的要求：
  + 可终止性：在有限时间内完成
  + 共识性：系统内的不同节点对一个事物处理结果相同
  + 合法性：？？
+ 对于一致性放宽条件
  + 一致性的理想情况，就是所有节点时刻保持数据的一致，在一个节点上进行了数据更改，用户立刻可以在其他节点上访问到最新的数据。理想情况是很难实现的，越接近理想情况，需要付出的代价就越大。所以，在实现中，对于一致性适当放宽要求，就有了下文的分类
  + 严格一致性：分布式系统完全等价于一台计算机
  + 强一致性：一个数据的副本进行更新后，对任意副本的访问都可以获得更新后的值。若想实现这个目标，在一个副本跟新后，需要对所有节点进行数据同步，同步过程是需要时间的，在完成节点之间数据同步之前，用户是没法读取数据的。（顺序一致性、线性一致性**）
  + 弱一致性：当数据更新后，不保证立刻可以访问到最新的值
    + 最终一致性：对数据更新后，存在一个不一致的时间窗口，在这个窗口内，不保证能访问到最新的值。但是最终可以达到达到一致（收敛）

### FLP不可能原理
+ 一致性问题的理论上界
+ 在网络可靠，存在节点失效（即便只有一个）的最小化异步模型系统中，不存在一个可以解决一致性问题的确定性算法。
+ 理解：对于异步分布式系统，总有一种场景会导致系统无法达成共识

### CAP原理
+ 强一致性（Consistency）
+ 可用性（Availablity）：任何非失败节点，在有限时间内可以应答请求
+ 分区容错性（Partition）：在网络分区时（某些节点故障），也能够对外提供满足一致性可用性的服务
+ 以上三个性质，不可能同时满足，系统设计中，弱化其中一项来保证其他两项的实现
+ 理解：作为工程上设计系统的指导，根据应用场景来决定如何取舍
  + 弱化一致性：引入时间窗口，保证最终一致性。但是在时间窗口内查询到的数据是不一致的，如此保证分区容错和可用
  + 弱化可用性：在达成一致之前或者产生故障时，对一些操作作出限制。比如数据修改操作在达成一致之前拒绝访问数据。一般用于对一致性要求很高的系统中，比如银行
  + 弱化分区容错性：在网络分区后，个分区保持一致性和可用性。（感觉并没什么意义）
